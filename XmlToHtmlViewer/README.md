# XML 报告查看器

> 一个轻量级、拖拽式 WPF 工具，用于直接查看带 XSL 样式的 XML 报告文件（如 ATML 格式）。

---

## 项目背景

在现代Web开发中，许多浏览器（如Chrome、Firefox、Edge等）已经逐渐放弃了对XSLT（Extensible Stylesheet Language Transformations）的原生支持。这导致许多依赖于XSL样式表进行XML转换的应用程序无法在现代浏览器中正常显示。

XML报告查看器应运而生，它提供了一个独立的桌面环境，能够：
- 解析带有XSL样式表引用的XML文件
- 在内部执行XSLT转换
- 将转换结果渲染为HTML并在内置浏览器中显示

该工具特别适用于查看测试报告（如JUnit、TestNG、ATML、Fluke等生成的XML）、浏览日志或结构化数据报告，以及在现代浏览器无法渲染XSL的情况下替代旧版IE查看XML报告。

---

## 工作原理

### XSLT转换流程

XML报告查看器的核心功能是通过以下步骤实现的：

1. **XML文件解析**：
   - 检测XML文件编码（UTF-8、UTF-16等）
   - 读取XML内容并解析其结构

2. **XSL样式表提取**：
   - 使用正则表达式从XML文件中提取`<?xml-stylesheet?>`处理指令
   - 解析XSL文件的相对路径并转换为绝对路径

3. **XSLT转换执行**：
   - 使用.NET的`XslCompiledTransform`类加载XSL文件
   - 将XML文件作为输入，应用XSL转换规则
   - 生成转换后的HTML内容

4. **HTML渲染**：
   - 确保HTML内容包含正确的UTF-8编码声明
   - 创建临时HTML文件存储转换结果
   - 使用WPF的WebBrowser控件加载并显示HTML内容

### 技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                    MainWindow (主窗口)                        │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐ │
│  │   HomeTab       │  │  HtmlTabItem    │  │  + 新建     │ │
│  │   (首页)        │  │  (HTML标签页)   │  │  (添加标签) │ │
│  └─────────────────┘  └─────────────────┘  └─────────────┘ │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                   XslTransformer                            │
├─────────────────────────────────────────────────────────────┤
│  1. 检测XML文件编码                                          │
│  2. 提取XSL样式表引用                                        │
│  3. 执行XSLT转换                                            │
│  4. 返回HTML内容                                            │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                   WebBrowser控件                            │
├─────────────────────────────────────────────────────────────┤
│  1. 创建临时HTML文件                                        │
│  2. 加载HTML内容                                            │
│  3. 渲染并显示                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 功能特点

- **拖拽支持**：直接将XML文件拖入窗口即可打开
- **多标签页界面**：可同时查看多个XML文件的转换结果
- **自动XSLT转换**：自动检测并应用XML文件中引用的XSL样式表
- **编码自动检测**：支持UTF-8、UTF-16等多种编码格式
- **错误处理**：提供详细的错误信息，帮助用户诊断问题
- **剪贴板操作**：支持复制内容到剪贴板，便于粘贴到Excel等应用
- **命令行支持**：可通过命令行参数直接打开XML文件

---

## 系统要求

### .NET Framework 4.8版本（推荐）
- Windows操作系统
- .NET Framework 4.8（大多数Windows系统已预装）
- 文件大小：约22KB

## 安装与部署

### .NET Framework 4.8版本（推荐）
1. 下载发布文件：`XmlToHtmlViewer.exe`和`XmlToHtmlViewer.exe.config`
2. 直接运行`XmlToHtmlViewer.exe`



## 使用说明

### 基本操作

1. **启动应用程序**：
   - 双击`XmlToHtmlViewer.exe`运行程序
   - 或通过命令行运行：`XmlToHtmlViewer.exe [XML文件路径]`

2. **打开XML文件**：
   - 方法一：直接将XML文件拖入应用程序窗口
   - 方法二：点击"+ 新建"标签页，选择"打开文件"按钮
   - 方法三：通过菜单栏的"文件" > "打开"选项

3. **查看转换结果**：
   - 应用程序将自动检测XML文件中的XSL样式表引用
   - 执行XSLT转换并在内置浏览器中显示HTML结果
   - 每个XML文件将在新的标签页中打开

4. **管理标签页**：
   - 点击标签页标题切换不同的XML文件视图
   - 点击标签页上的"×"按钮关闭当前标签页
   - 首页标签页不可关闭

### 高级功能

1. **刷新内容**：
   - 点击HTML视图中的"刷新"按钮重新加载和转换XML文件
   - 当XML或XSL文件被外部修改后，可使用此功能更新视图

2. **复制内容**：
   - 右键点击HTML内容可选择复制
   - 支持将表格数据复制到Excel等应用程序

3. **命令行参数**：
   - 程序支持通过命令行参数直接打开XML文件
   - 示例：`XmlToHtmlViewer.exe "C:\path\to\your\file.xml"`

---

## 项目结构

```
XmlToHtmlViewer/
├── App.xaml                  # 应用程序定义和资源
├── App.xaml.cs               # 应用程序启动逻辑
├── MainWindow.xaml           # 主窗口UI定义
├── MainWindow.xaml.cs        # 主窗口逻辑和事件处理
├── HomeTab.xaml              # 首页标签页UI定义
├── HomeTab.xaml.cs           # 首页标签页逻辑
├── HtmlTabItem.xaml          # HTML标签项UI定义
├── HtmlTabItem.xaml.cs       # HTML标签项逻辑和HTML渲染
├── XslTransformer.cs         # XSLT转换核心功能实现
├── ClipboardHelper.cs        # 剪贴板操作辅助类
├── XmlToHtmlViewer.csproj    # 项目配置文件
└── Properties/               # 应用程序属性和资源
    ├── Resources.Designer.cs # 资源文件代码
    ├── Resources.resx        # 资源文件
    ├── Settings.Designer.cs  # 应用程序设置代码
    └── Settings.settings     # 应用程序设置
```

### 核心组件说明

#### XslTransformer.cs
负责XSLT转换的核心组件，主要功能包括：
- XML文件编码检测
- XSL样式表引用提取
- XSLT转换执行
- 错误处理和反馈

#### HtmlTabItem.xaml.cs
负责HTML渲染和显示的组件，主要功能包括：
- 创建和管理HTML标签页
- 调用XslTransformer执行转换
- 创建临时HTML文件
- 使用WebBrowser控件加载和显示HTML内容

#### MainWindow.xaml.cs
主窗口逻辑控制器，主要功能包括：
- 管理标签页生命周期
- 处理文件拖放操作
- 实现文件打开对话框
- 处理应用程序菜单命令
- 管理应用程序状态

---

## 开发环境

- **开发框架**：WPF 
- **编程语言**：C#
- **.NET版本**：.NET Framework 4.8 
- **项目格式**：.NET项目
- **IDE**：Visual Studio 2022 

---

## 常见问题

### Q: 应用程序无法启动
A: 请确保您的系统满足系统要求。如果使用.NET 8框架依赖版本，请确保已安装.NET 8运行时。如果使用.NET Framework 4.8版本，大多数Windows系统已预装，无需额外安装。

### Q: XML文件无法正确转换
A: 请检查以下几点：
- XML文件格式是否正确
- XML文件中是否包含正确的XSL样式表引用
- XSL文件路径是否正确（相对于XML文件的位置）
- XSL文件是否存在

### Q: 转换后的HTML显示乱码
A: 这可能是由于编码问题导致的。应用程序会自动检测XML文件编码，但如果检测失败，可以尝试：
- 确保XML文件包含正确的编码声明（如`<?xml version="1.0" encoding="UTF-8"?>`）
- 检查XSL文件中的编码设置


### Q: 支持哪些类型的XML文件
A: 理论上支持所有包含XSL样式表引用的XML文件，特别适用于：
- ATML（Automatic Test Markup Language）测试报告
- JUnit测试报告
- TestNG测试报告
- 其他自定义格式的结构化XML数据

---

## 项目运行截图

![XML报告查看器界面](https://img.erpweb.eu.org/imgs/2025/10/024c5dfc5d77c0df.png)


