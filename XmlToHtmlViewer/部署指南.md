# XmlToHtmlViewer 部署指南

## 概述

XmlToHtmlViewer 是一个基于 WPF 和 CefSharp 的 XML 到 HTML 转换查看器应用程序。由于 CefSharp 基于 Chromium 嵌入式框架(CEF)，它需要多个文件才能正常运行，无法打包为单个 exe 文件。

## 部署包选项

我们提供了两种部署包选项，以满足不同的需求：

### 1. 完整部署包

- **位置**: `bin\x64\Release\SingleExe`
- **大小**: 约 326 MB
- **特点**: 包含所有 220 种语言支持
- **适用场景**: 需要多语言支持或不确定最终用户语言环境的情况

### 2. 精简部署包

- **位置**: `bin\x64\Release\CompactPackage`
- **大小**: 约 294 MB (节省约 32 MB)
- **特点**: 仅包含英语和中文语言支持
- **适用场景**: 已知用户只需要英语和中文界面，或者对部署包大小有严格要求的情况

## 创建部署包

### 自动创建

使用我们提供的部署包生成工具：

1. 打开命令提示符或 PowerShell
2. 导航到项目目录：`cd g:\WPF\XmlToHtmlViewer\XmlToHtmlViewer\bin\x64\Release`
3. 运行部署包生成工具：`CreateDeploymentPackage.bat`
4. 按照提示选择要创建的部署包类型

### 手动创建

#### 创建完整部署包

1. 打开命令提示符或 PowerShell
2. 导航到项目目录：`cd g:\WPF\XmlToHtmlViewer\XmlToHtmlViewer\bin\x64\Release`
3. 运行完整部署包脚本：`CreateSingleExeWithCostura.bat`
4. 部署包将创建在 `SingleExe` 目录中

#### 创建精简部署包

1. 打开命令提示符或 PowerShell
2. 导航到项目目录：`cd g:\WPF\XmlToHtmlViewer\XmlToHtmlViewer\bin\x64\Release`
3. 运行精简部署包脚本：`CreateCompactPackage.bat`
4. 部署包将创建在 `CompactPackage` 目录中

## 部署步骤

1. **选择部署包**: 根据需要选择完整版或精简版部署包
2. **复制文件**: 将整个部署包目录复制到目标计算机
3. **安装依赖**: 确保目标计算机安装了 Visual C++ Redistributable
4. **运行程序**: 执行 `XmlToHtmlViewer.exe`

## 系统要求

- 操作系统: Windows 7 或更高版本 (64位)
- .NET Framework: 4.7.2 或更高版本
- Visual C++ Redistributable: 2015 或更高版本
- 内存: 至少 2 GB RAM (推荐 4 GB 或更多)
- 硬盘空间: 至少 350 MB 可用空间

## 创建安装程序

为了提供更好的用户体验，可以使用安装程序打包工具（如 Inno Setup 或 NSIS）创建安装程序：

### Inno Setup 示例脚本

```innosetup
[Setup]
AppName=XmlToHtmlViewer
AppVersion=1.0
DefaultDirName={pf}\XmlToHtmlViewer
DefaultGroupName=XmlToHtmlViewer
OutputDir=Installer
OutputBaseFilename=XmlToHtmlViewer-Setup
Compression=lzma
SolidCompression=yes

[Files]
; 根据选择的部署包类型，复制相应文件
Source: "SingleExe\*"; DestDir: "{app}"; Flags: ignoreversion recursesubdirs createallsubdirs
; 或者使用精简版:
; Source: "CompactPackage\*"; DestDir: "{app}"; Flags: ignoreversion recursesubdirs createallsubdirs

[Icons]
Name: "{group}\XmlToHtmlViewer"; Filename: "{app}\XmlToHtmlViewer.exe"
Name: "{commondesktop}\XmlToHtmlViewer"; Filename: "{app}\XmlToHtmlViewer.exe"

[Run]
Filename: "{app}\XmlToHtmlViewer.exe"; Description: "{cm:LaunchProgram,XmlToHtmlViewer}"; Flags: nowait postinstall skipifsilent

[Code]
// 检查并安装 Visual C++ Redistributable
function InitializeSetup(): Boolean;
var
  ResultCode: Integer;
begin
  Result := True;
  if not RegKeyExists(HKLM, 'SOFTWARE\Microsoft\VisualStudio\14.0\VC\Runtimes\x64') then
  begin
    if MsgBox('需要安装 Visual C++ Redistributable 才能运行此程序。是否现在安装？', mbConfirmation, MB_YESNO) = IDYES then
    begin
      ExtractTemporaryFile('VC_redist.x64.exe');
      if not Exec(ExpandConstant('{tmp}\VC_redist.x64.exe'), '/quiet /norestart', '', SW_SHOWNORMAL, ewWaitUntilTerminated, ResultCode) then
      begin
        MsgBox('Visual C++ Redistributable 安装失败。', mbError, MB_OK);
        Result := False;
      end;
    end
    else
    begin
      Result := False;
    end;
  end;
end;
```

## 故障排除

### 常见问题

1. **程序无法启动**
   - 检查是否安装了 Visual C++ Redistributable
   - 确保所有文件都已正确复制到目标目录
   - 检查是否有足够的权限运行程序

2. **界面显示异常**
   - 确保系统满足最低要求
   - 尝试以管理员身份运行程序
   - 检查显卡驱动程序是否更新

3. **功能异常**
   - 检查是否有足够的系统内存
   - 确保所有必要的文件都在同一目录中
   - 尝试重新启动程序

### 日志文件

如果程序遇到问题，可以检查以下位置是否有日志文件：
- Windows 事件查看器中的应用程序日志
- 程序目录下的任何 log 文件

## 技术支持

如果遇到无法解决的问题，请联系技术支持并提供以下信息：
- 操作系统版本
- .NET Framework 版本
- 错误消息或屏幕截图
- 问题发生的步骤

---

*本指南最后更新于 2024年*